{% extends "base.html" %} 
{% block title %}Create event recurrance{% endblock title %}
{% block content %}

<div class="row g-5">
  <div class="col-md-12">
    <form class="needs-validation" novalidate="">
      <div class="row g-3">
        <div class="col-md-6">
          <h4 class="mb-3">Event details</h4>
          <div class="row g-3">
            

              {% for field in custom_fields%}
                {% if field.field_type == "text"%}
                <div class="col-6">
                  <label class="form-label" for="{{ field.field_name }}">{{ field.field_name }}</label>

                  <input
                    id="{{ field.field_name }}"
                    name="{{ field.field_name }}"
                    type="text"
                    placeholder=""
                    class="form-control"
                    value="{{ field.field_data }}"
                    required=""
                  />
                </div>
                {% endif %}
              
              {% endfor %}

            
            

            <div class="col-sm-12">
              <label class="form-label" for="details">Details</label>
              <textarea
                class="form-control"
                id="details"
                name="details"
              ></textarea>
            </div>

            <div class="col-6">
              <label class="form-label" for="timestart">Start time</label>

              <input
                id="timestart"
                name="timestart"
                type="text"
                placeholder=""
                class="form-control time"
                required=""
              />
            </div>

            <div class="col-6">
              <label class="form-label" for="timefinish">Finish time</label>
              <input
                id="timefinish"
                name="timefinish"
                type="text"
                placeholder=""
                class="form-control time"
                required=""
              />
            </div>

            <div class="col-sm-6">
              <div class="control-group">
                <label class="form-label" for="room">Room</label>
                <select id="room" name="room" class="form-select">
                  {% for room in rooms %}
                  <option value="{{ room.id }}">{{ room.name }}</option>
                  {% endfor %}
                </select>
              </div>
            </div>
            <div class="col-sm-6">
              <label class="form-label" for="capacity">Maximum bookings</label>
              <input
                id="capacity"
                name="capacity"
                type="number"
                placeholder=""
                class="form-control"
                required=""
              />
            </div>
          </div>
        </div>

        <div class="col-md-5 offset-md-1">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            Recurrence
          </h4>

          <div class="row g-3">
            <div class="col-6">
              <label class="form-label" for="datestart">Start</label>

              <input
                id="datestart"
                name="datestart"
                type="text"
                placeholder=""
                class="form-control cal"
                required=""
              />
            </div>

            <div class="col-6">
              <label class="form-label" for="datefinish">End by</label>
              <input
                id="datefinish"
                name="datefinish"
                type="text"
                placeholder=""
                class="form-control cal"
                required=""
              />
            </div>
          </div>

          <h4 class="d-flex justify-content-between align-items-center mb-3">
            Recurrence pattern
          </h4>
          <div class="row g-3">
            <div class="col-12">
              <div class="control-group">
                <label class="form-label" for="recurrance-period">Period</label>
                <select
                  id="recurrance-period"
                  name="recurrance-period"
                  class="form-select"
                >
                  <option value="daily">Daily</option>
                  <option selected="selected" value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                </select>
              </div>
            </div>

            <div class="col-12">
              <div class="period-settings" style="display: none" id="daily">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="d_settings"
                    id="d_daily"
                  />
                  <div class="form-check-label" for="d_settings">
                    <span class="d-inline">Every</span>
                    <input
                      id="d_interval_days"
                      name="d_interval_days"
                      type="number"
                      placeholder=""
                      class="form-control d-inline"
                      required=""
                    />
                    <span class="d-inline">day(s)</span>
                  </div>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="d_settings"
                    id="d_weekdays"
                    checked
                  />
                  <label class="form-check-label" for="d_settings">
                    Every weekday
                  </label>
                </div>
              </div>
              <div class="period-settings" id="weekly">
                <span class="d-inline">Recur every</span>
                <input
                  id="w_interval_weeks"
                  name="w_interval_weeks"
                  type="number"
                  placeholder=""
                  class="form-control d-inline"
                  required=""
                />
                <span class="d-inline">week(s) on:</span>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="MO"
                    name="m_mo"
                    id="m_mo"
                  />
                  <label class="form-check-label" for="m_mo"> Monday </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="TU"
                    name="m_tu"
                    id="m_tu"
                  />
                  <label class="form-check-label" for="m_tu"> Tuesday </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="WE"
                    name="m_we"
                    id="m_we"
                  />
                  <label class="form-check-label" for="m_we"> Wednesday </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="TH"
                    name="m_th"
                    id="m_th"
                  />
                  <label class="form-check-label" for="m_th"> Thursday </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="FR"
                    name="m_fr"
                    id="m_fr"
                  />
                  <label class="form-check-label" for="m_fr"> Friday </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="SA"
                    name="m_sa"
                    id="m_sa"
                  />
                  <label class="form-check-label" for="m_sa"> Saturday </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    value="SU"
                    name="m_su"
                    id="m_su"
                  />
                  <label class="form-check-label" for="m_su"> Sunday </label>
                </div>
              </div>
            </div>
            <div class="period-settings" style="display: none" id="monthly">
              MONTHLY
            </div>
          </div>
        </div>
      </div>

      <hr class="my-4" />

      <button class="w-100 btn btn-primary btn-lg" type="submit">
        Generate events
      </button>
    </form>
  </div>
</div>

<div class="row g-5">
  <div class="col-md-12">
    <table class="table">
      <thead>
        <tr>
          <th>Presenter</th>
          <th>Max.bookings</th>
          <th>Details</th>
          <th>Start time</th>
          <th>Finish time</th>
          <th>Room</th>
        </tr>
      </thead>
      <tbody>
        {% for session in sessions %}
        <tr>
          <td scope="row">{{ session.custom_fields.custom_field.field_data }}</td>
          <td>{{ session.capacity }}</td>
          <td>{{ session.details }}</td>
          <td>{{ session.sessions_dates.sessions_date.timestart|time_format }}</td>
          <td>{{ session.sessions_dates.sessions_date.timefinish|time_format }}</td>
          <td>{{ session.sessions_dates.sessions_date.room.name }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock content %} 

{% block body_bottom_js %}

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
  flatpickr(".time", {
    enableTime: true,
    noCalendar: true,
    dateFormat: "H:i",
  });
  flatpickr(".cal", {
    enableTime: false,
    dateFormat: "Y-m-d",
  });
</script>

<script>
  let recurrancePeriod = document.querySelector("#recurrance-period");
  let settings = document.querySelectorAll(".period-settings");
  recurrancePeriod.addEventListener("change", function () {
    // handle change
    for (var i = 0; i < settings.length; i++) {
      if (settings[i].id != recurrancePeriod.value) {
        settings[i].style.display = "none";
      } else {
        settings[i].style.display = "block";
      }
    }
  });
</script>
{% endblock %}
